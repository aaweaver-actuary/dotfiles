#!/bin/zsh

# Exit on error
set -e

# Update and upgrade apk packages
apk update
apk upgrade

# Install Python and pip
apk add --no-cache python3 py3-pip

# Install build dependencies for Python packages that require compilation
# Needed for Snowflake dependencies like cryptography
apk add --no-cache gcc musl-dev python3-dev libffi-dev openssl-dev cargo

# Check if Python and pip are installed
python3 --version
pip3 --version

# Install dbt core, Snowflake, and DuckDB adapters
pip3 install dbt-core dbt-snowflake dbt-duckdb

# Check dbt version to confirm correct installation
dbt --version

# Optionally create a simple dbt project
# Customize or remove this section depending on your existing dbt setup
mkdir dbt_project
cd dbt_project
dbt init my_sample_project

# Print end of installation message
echo "dbt core, dbt-snowflake, and dbt-duckdb have been installed and initialized."